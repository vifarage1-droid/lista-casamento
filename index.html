<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Lista de Casamento</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#e0f2f7;margin:0;padding:20px}
h1{text-align:center;color:#1e88e5}
.sub{text-align:center;color:#555;margin-bottom:30px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px}
.card{background:#fff;border-radius:16px;box-shadow:0 4px 10px rgba(30,136,229,.15);overflow:hidden}
.card img{width:100%;height:180px;object-fit:cover}
.content{padding:16px}
.price{color:#1e88e5;font-weight:bold;font-size:18px;margin:10px 0}
button{width:100%;padding:12px;border:none;border-radius:10px;font-weight:bold;cursor:pointer}
.gift{background:#1e88e5;color:#fff}
.gift:hover{background:#1976d2}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:1000}
.modal.active{display:flex}
.box{background:#fff;border-radius:16px;padding:24px;max-width:420px;width:90%;text-align:center;max-height:90vh;overflow-y:auto}
.pix{background:#e3f2fd;border:2px dashed #1e88e5;border-radius:10px;padding:15px;margin:12px 0}
.pix-key{background:#fff;padding:12px;border-radius:8px;margin:10px 0;border:2px solid #1e88e5;word-break:break-all;font-family:monospace;font-size:12px;position:relative;max-height:80px;overflow-y:auto}
.copy-btn{background:#1e88e5;color:#fff;padding:10px 20px;border-radius:8px;border:none;margin-top:10px;cursor:pointer;font-size:16px;font-weight:bold}
.copy-btn:hover{background:#1976d2}
.copy-btn.copied{background:#28a745}
.recipient-info{font-size:12px;color:#666;margin-top:10px;font-style:italic}
.paid{background:#28a745;color:#fff;margin-top:15px}
.paid:hover{background:#218838}
.back{margin-top:8px;background:#6c757d;color:#fff}
.back:hover{background:#5a6268}
.wa{display:block;margin-top:12px;background:#25D366;color:#fff;padding:12px;border-radius:10px;text-decoration:none;font-weight:bold}
.wa:hover{background:#1fb855}
.form-field{margin:15px 0;text-align:left}
.form-field label{display:block;margin-bottom:5px;font-weight:bold;color:#333}
.form-field input,.form-field textarea{width:100%;padding:10px;border:2px solid #90caf9;border-radius:8px;font-size:16px;box-sizing:border-box}
.form-field input:focus,.form-field textarea:focus{outline:none;border-color:#1e88e5}
.qty-input{width:80px!important;font-size:18px!important;text-align:center;margin:8px 0}
#totalTxt{font-size:20px;color:#1e88e5;font-weight:bold;margin:15px 0}
.admin-btn{position:fixed;bottom:20px;right:20px;width:50px;height:50px;border-radius:50%;background:#1e88e5;color:#fff;border:none;font-size:20px;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.2);z-index:999}
.admin-panel{display:none;padding:20px}
.admin-panel.active{display:block}
.main-content.hidden{display:none}
.message-card{background:#f5f5f5;padding:15px;margin:10px 0;border-radius:8px;text-align:left;position:relative}
.message-card h4{margin:0 0 5px 0;color:#1e88e5}
.message-card p{margin:5px 0}
.loading{text-align:center;padding:20px;color:#666}
.status-indicator{position:fixed;top:10px;right:10px;padding:8px 15px;border-radius:20px;font-size:12px;font-weight:bold;z-index:1000}
.status-online{background:#28a745;color:white}
.status-offline{background:#dc3545;color:white}
.delete-btn{position:absolute;top:10px;right:10px;background:#dc3545;color:#fff;border:none;padding:5px 10px;border-radius:5px;font-size:12px;cursor:pointer}
.delete-btn:hover{background:#c82333}
.pix-instructions{background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:12px;margin:10px 0;font-size:13px;text-align:left}
.pix-instructions ol{margin:8px 0;padding-left:20px}
.pix-instructions li{margin:5px 0}
</style>
</head>
<body>

<div id="statusIndicator" class="status-indicator status-offline">Conectando...</div>

<div class="main-content" id="mainContent">
  <h1>üíï Nossa Lista de Casamento üíï</h1>
  <p class="sub">Ajude a realizar nosso sonho!</p>
  <div class="loading" id="loading">Carregando...</div>
  <div class="grid" id="grid"></div>
</div>

<div class="admin-panel" id="adminPanel">
  <h1>üîê Painel Administrativo</h1>
  <p class="sub">√Årea restrita aos noivos</p>
  <button class="back" onclick="exitAdmin()">Voltar para lista</button>
  <div id="adminContent"></div>
</div>

<button class="admin-btn" onclick="accessAdmin()">üë§</button>

<div class="modal" id="modal"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc,
    deleteDoc,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAOAcUcej3uDDHdE0PNGHmDTWO2P8qBwTs",
    authDomain: "lista-de-casamento-final.firebaseapp.com",
    projectId: "lista-de-casamento-final",
    storageBucket: "lista-de-casamento-final.firebasestorage.app",
    messagingSenderId: "1000194052334",
    appId: "1:1000194052334:web:e8f2880596887df7ea63ff"
  };

  let app, db;
  
  try {
    app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    console.log("‚úÖ Firebase inicializado!");
    updateStatus(true);
  } catch (error) {
    console.error("‚ùå Erro Firebase:", error);
    updateStatus(false);
  }

  function updateStatus(online) {
    const indicator = document.getElementById('statusIndicator');
    if (online) {
      indicator.textContent = 'Online ‚úì';
      indicator.className = 'status-indicator status-online';
    } else {
      indicator.textContent = 'Offline ‚úó';
      indicator.className = 'status-indicator status-offline';
    }
  }

  window.storage = {
    async get(key) {
      try {
        const reference = doc(db, "storage", key);
        const snap = await getDoc(reference);
        if (!snap.exists()) return null;
        const data = snap.data();
        return { value: typeof data.value === "string" ? data.value : JSON.stringify(data.value) };
      } catch (e) {
        console.error(`‚ùå Erro ao buscar ${key}:`, e);
        updateStatus(false);
        return null;
      }
    },

    async set(key, value) {
      try {
        await setDoc(doc(db, "storage", key), { value: value });
        console.log(`‚úÖ Salvo: ${key}`);
        updateStatus(true);
        return true;
      } catch (e) {
        console.error(`‚ùå Erro ao salvar ${key}:`, e);
        updateStatus(false);
        alert('Erro ao salvar. Verifique sua conex√£o.');
        return false;
      }
    },

    async list(prefix) {
      try {
        const snap = await getDocs(collection(db, "storage"));
        const keys = [];
        snap.forEach(d => {
          if (d.id.startsWith(prefix)) keys.push(d.id);
        });
        return { keys };
      } catch (e) {
        console.error(`‚ùå Erro ao listar:`, e);
        updateStatus(false);
        return { keys: [] };
      }
    },

    async delete(key) {
      try {
        await deleteDoc(doc(db, "storage", key));
        console.log(`‚úÖ Deletado: ${key}`);
        return true;
      } catch (e) {
        console.error(`‚ùå Erro ao deletar ${key}:`, e);
        return false;
      }
    }
  };

  window.dispatchEvent(new Event('firebaseReady'));
</script>

<script>
const QUOTA = 300;
const PIX_COPIA_COLA = '00020126410014br.gov.bcb.pix0119vifarage1@gmail.com5204000053039865802BR5921Vinicius';
const RECIPIENT_NAME = 'Vinicius Farage Ramos';
const RECIPIENT_BANK = 'Mercado Pago';
const WA = '5561982426059';
const ADMIN_PASSWORD = 'noivos2026';

const items = [
 {id:'geladeira',n:'Geladeira',v:3000,d:'Geladeira frost free duplex para nossa cozinha.',i:'data:image/jpeg;base64,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'},
 {id:'filtro',n:'Filtro de √Ågua',v:1200,d:'Filtro de √°gua moderno e eficiente.',i:'https://electrolux.vtexassets.com/arquivos/ids/275966-500-500?v=638853563246270000&width=500&height=500&aspect=true&format=auto'},
 {id:'tv',n:'Televis√£o',v:2400,d:'Televis√£o 4K para filmes e s√©ries.',i:'https://www.lg.com/content/dam/channel/wcms/br/images/tv/50qned70asa-bwz/dz-01.jpg/jcr:content/renditions/thum-1600x1062.jpeg?w=800'},
 {id:'cama',n:'Cama',v:4200,d:'Cama box de casal Queen Size ',i:'https://www.google.com/imgres?q=cama%20box&imgurl=https%3A%2F%2Fcdn.leroymerlin.com.br%2Fproducts%2Fcama_box_casal_colchao___box_138x188_molas_ensacadas_cama_inb_1568098878_549a_600x600.jpg&imgrefurl=https%3A%2F%2Fwww.leroymerlin.com.br%2Fcama-box-casal-colchao---box-138x188-molas-ensacadas-cama-inbox-confort-snow_1568098878&docid=ojw5F7UHIfYO2M&tbnid=dBqT6U5rE8O7WM&vet=12ahUKEwiAkae0z9mSAxXXH7kGHW2LNIEQnPAOegQIPxAB..i&w=600&h=600&hcb=2&ved=2ahUKEwiAkae0z9mSAxXXH7kGHW2LNIEQnPAOegQIPxAB'},
 {id:'microondas',n:'Micro-ondas',v:600,d:'Micro-ondas pr√°tico para o dia a dia.',i:'https://www.lg.com/content/dam/channel/wcms/br/images/produtos/ha/mwo/ms3043br/1-1600-ms3043br.jpg/jcr:content/renditions/thum-1600x1062.jpeg?w=800'},
 {id:'maquina',n:'M√°quina de Lavar',v:1800,d:'M√°quina de lavar roupas autom√°tica.',i:'https://www.lg.com/content/dam/channel/wcms/br/images/lavadoras-de-roupas/cv9014wc2_abwfbrs_essp_br_c/gallery/large01.jpg?w=800'},
 {id:'lavalou√ßas',n:'Lava-lou√ßas',v:2100,d:'Lava-lou√ßas para facilitar a rotina.',i:'https://brastemp.vtexassets.com/arquivos/ids/267500-1600-auto?v=638973414195430000&width=1600&height=auto&aspect=true'},
 {id:'airfryer',n:'Air Fryer',v:300,d:'Air fryer para refei√ß√µes saud√°veis.',i:'https://electrolux.vtexassets.com/arquivos/ids/268536-500-500?v=638778160471700000&width=500&height=500&aspect=true&format=auto'}
];

function formatBRL(valor) {
 return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

items.forEach(it=>{it.total=Math.ceil(it.v/QUOTA);it.rest=it.total});

function copyToClipboard(text, buttonId) {
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById(buttonId);
    const originalText = btn.textContent;
    btn.textContent = '‚úì C√≥digo Copiado!';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = originalText;
      btn.classList.remove('copied');
    }, 2500);
  }).catch(err => {
    alert('Erro ao copiar. Por favor, copie manualmente o c√≥digo acima.');
  });
}

function initApp() {
  if (typeof storage === 'undefined') {
    window.addEventListener('firebaseReady', () => {
      loadData();
    });
  } else {
    loadData();
  }
}

async function loadData(){
 try {
  for(let item of items){
   const result = await storage.get('item_'+item.id);
   if(result && result.value){
    const data = JSON.parse(result.value);
    if(data && typeof data.rest !== 'undefined') {
      item.rest = data.rest;
    }
   }
  }
 } catch(error) {
  console.error('Erro ao carregar:', error);
 }
 document.getElementById('loading').style.display = 'none';
 render();
}

async function saveItem(item){
 try {
  const saved = await storage.set('item_'+item.id, JSON.stringify({rest: item.rest}));
  return saved;
 } catch(error) {
  console.error('saveItem error:', error);
  return false;
 }
}

async function savePurchase(itemId, itemName, qty, nome, mensagem, total){
 try {
  const timestamp = Date.now();
  const purchaseData = {
   itemId, itemName, qty, nome, mensagem, total, timestamp,
   date: new Date().toLocaleString('pt-BR')
  };
  const saved = await storage.set('purchase_'+timestamp, JSON.stringify(purchaseData));
  return saved;
 } catch(error) {
  console.error('savePurchase error:', error);
  return false;
 }
}

function render(){
 const grid=document.getElementById('grid');
 grid.innerHTML='';
 items.forEach((it,idx)=>{
  grid.innerHTML+=`
  <div class="card">
   <img src="${it.i}" alt="${it.n}">
   <div class="content">
    <h3>${it.n}</h3>
    <p>${it.d}</p>
    <div class="price">${formatBRL(it.v)}</div>
    <p><b>${it.rest}</b> de <b>${it.total}</b> cotas dispon√≠veis<br>(${formatBRL(QUOTA)} cada)</p>
    <button class="gift" onclick="openPay(${idx})" ${it.rest === 0 ? 'disabled style="background:#ccc"' : ''}>
     ${it.rest === 0 ? 'Esgotado' : 'Presentear üéÅ'}
    </button>
   </div>
  </div>`;
 });
}

function openPay(idx){
 const it=items[idx];
 if(it.rest === 0) return;
 const modal=document.getElementById('modal');
 
 modal.innerHTML=`
 <div class="box">
  <h3>${it.n}</h3>
  <p>Cotas dispon√≠veis: <b>${it.rest}</b></p>
  <div class="form-field">
   <label>Quantidade de cotas:</label>
   <input type="number" id="qty" class="qty-input" min="1" max="${it.rest}" value="1">
  </div>
  <p id="totalTxt"></p>
  <div class="form-field">
   <label>Nome Completo: *</label>
   <input type="text" id="nomeCompleto" placeholder="Digite seu nome completo" required>
  </div>
  <div class="form-field">
   <label>Mensagem para os Noivos:</label>
   <textarea id="mensagem" rows="4" placeholder="Deixe uma mensagem carinhosa..."></textarea>
  </div>
  
  <p style="margin-top:25px;font-size:18px;font-weight:bold;color:#1e88e5">üí≥ Pagamento via PIX</p>
  
  <div class="pix">
   <p style="font-weight:bold;margin-bottom:10px;font-size:15px">üì± PIX Copia e Cola</p>
   <div class="pix-key">${PIX_COPIA_COLA}</div>
   <button class="copy-btn" id="copyPixBtn" onclick="copyToClipboard('${PIX_COPIA_COLA}', 'copyPixBtn')">üìã Copiar C√≥digo PIX</button>
   <p style="font-size:16px;font-weight:bold;color:#333;margin-top:15px">${RECIPIENT_NAME} - ${RECIPIENT_BANK}</p>
   <p style="font-size:18px;font-weight:bold;color:#1e88e5;margin-top:10px">Valor: <span id="valorPix">${formatBRL(QUOTA)}</span></p>
  </div>
  
  <button class="paid" onclick="confirmPayment(${idx})">‚úì J√° fiz o pagamento</button>
  <button class="back" onclick="closeModal()">Voltar</button>
 </div>`;
 modal.classList.add('active');
 updateTotal();
 document.getElementById('qty').oninput=updateTotal;
}

function updateTotal(){
 const q=parseInt(document.getElementById('qty').value);
 const total = q * QUOTA;
 document.getElementById('totalTxt').innerHTML=`<b>${q}</b> ${q === 1 ? 'cota custar√°' : 'cotas custar√£o'} <b>${formatBRL(total)}</b>`;
 const valorPixEl = document.getElementById('valorPix');
 if(valorPixEl) {
   valorPixEl.textContent = formatBRL(total);
 }
}

async function confirmPayment(idx){
 const it=items[idx];
 const q=parseInt(document.getElementById('qty').value);
 const nome = document.getElementById('nomeCompleto').value.trim();
 const mensagem = document.getElementById('mensagem').value.trim();
 
 if(!nome){ alert('Por favor, preencha seu nome completo.'); return; }
 if(q>it.rest){ alert('Quantidade indispon√≠vel'); return; }
 
 const modal = document.getElementById('modal');
 modal.innerHTML = '<div class="box"><div class="loading">Salvando...</div></div>';
 
 it.rest-=q;
 const totalPago = q * QUOTA;
 const saved1 = await saveItem(it);
 const saved2 = await savePurchase(it.id, it.n, q, nome, mensagem, totalPago);
 
 if(!saved1 || !saved2){
  alert('Erro ao salvar. Por favor, tente novamente.');
  it.rest+=q;
  closeModal();
  return;
 }
 
 render();
 
 const waMessage = `Ol√°! Acabei de presentear voc√™s com *${q} ${q === 1 ? 'cota' : 'cotas'}* do item *${it.n}* (${formatBRL(totalPago)}).%0A%0A*Nome:* ${nome}%0A${mensagem ? `*Mensagem:* ${mensagem}%0A` : ''}%0AVou enviar o comprovante de pagamento agora! üíï`;
 
 modal.innerHTML=`
 <div class="box">
  <h2>üíñ Muito obrigado, ${nome.split(' ')[0]}! üíñ</h2>
  <p>Seu carinho significa muito para n√≥s!</p>
  <p><b>Voc√™ presenteou:</b><br>${q} ${q === 1 ? 'cota' : 'cotas'} - ${it.n}<br><b>Total: ${formatBRL(totalPago)}</b></p>
  ${mensagem ? `<p style="background:#e3f2fd;padding:10px;border-radius:8px;font-style:italic">"${mensagem}"</p>` : ''}
  <p style="margin-top:15px">Por favor, envie o comprovante do pagamento pelo WhatsApp para confirmarmos:</p>
  <a class="wa" href="https://wa.me/${WA}?text=${waMessage}" target="_blank">üì≤ Enviar comprovante no WhatsApp</a>
  <button class="back" onclick="closeModal()">Fechar</button>
 </div>`;
 modal.classList.add('active');
}

function closeModal(){ document.getElementById('modal').classList.remove('active'); }

function accessAdmin(){
 const password = prompt('Digite a senha de administrador:');
 if(password === ADMIN_PASSWORD) showAdmin();
 else if(password !== null) alert('Senha incorreta!');
}

async function deletePurchase(key, itemId, qty) {
  if(!confirm('Tem certeza que deseja deletar este presente?')) return;
  
  try {
    await storage.delete(key);
    
    const item = items.find(it => it.id === itemId);
    if(item) {
      item.rest += qty;
      await saveItem(item);
    }
    
    alert('Presente deletado com sucesso!');
    showAdmin();
  } catch(error) {
    console.error('Erro ao deletar:', error);
    alert('Erro ao deletar. Tente novamente.');
  }
}

async function showAdmin(){
 document.getElementById('mainContent').classList.add('hidden');
 document.getElementById('adminPanel').classList.add('active');
 const content = document.getElementById('adminContent');
 content.innerHTML = '<div class="loading">Carregando dados...</div>';
 
 try {
  const purchases = [];
  const keysObj = await storage.list('purchase_');
  
  if(keysObj && keysObj.keys){
   for(let key of keysObj.keys){
    const result = await storage.get(key);
    if(result && result.value) {
      const data = JSON.parse(result.value);
      data.key = key;
      purchases.push(data);
    }
   }
  }
  
  purchases.sort((a, b) => b.timestamp - a.timestamp);
  let totalArrecadado = purchases.reduce((acc, p) => acc + p.total, 0);
  
  let html = `<h2>üìä Resumo</h2><div class="message-card"><h4>Total Arrecadado</h4><p style="font-size:24px;color:#1e88e5;font-weight:bold">${formatBRL(totalArrecadado)}</p><p>Total de presentes: ${purchases.length}</p></div><h2>üéÅ Hist√≥rico de Presentes</h2>`;
  
  items.forEach(item => {
   const itemPurchases = purchases.filter(p => p.itemId === item.id);
   const cotasVendidas = item.total - item.rest;
   const valorArrecadado = cotasVendidas * QUOTA;
   if(itemPurchases.length > 0){
    html += `<div class="message-card"><h4>${item.n}</h4><p><b>Cotas vendidas:</b> ${cotasVendidas}/${item.total}</p><p><b>Valor arrecadado:</b> ${formatBRL(valorArrecadado)}</p><p><b>Presenteadores:</b></p><ul style="margin:5px 0;padding-left:20px">`;
    itemPurchases.forEach(p => html += `<li>${p.nome} - ${p.qty} ${p.qty === 1 ? 'cota' : 'cotas'} (${p.date}) <button class="delete-btn" onclick="deletePurchase('${p.key}', '${p.itemId}', ${p.qty})">Deletar</button></li>`);
    html += `</ul></div>`;
   }
  });
  
  html += `<h2>üí¨ Mensagens dos Convidados</h2>`;
  const mensagens = purchases.filter(p => p.mensagem);
  if(mensagens.length > 0){
   mensagens.forEach(m => html += `<div class="message-card"><button class="delete-btn" onclick="deletePurchase('${m.key}', '${m.itemId}', ${m.qty})">Deletar</button><h4>${m.nome}</h4><p style="font-style:italic">"${m.mensagem}"</p><p style="font-size:12px;color:#666">Presente: ${m.itemName} - ${m.date}</p></div>`);
  } else {
   html += `<p class="sub">Nenhuma mensagem ainda</p>`;
  }
  
  html += `<button class="back" style="margin-top:20px" onclick="resetData()">‚ö†Ô∏è Resetar TODOS os Dados</button>`;
  content.innerHTML = html;
 } catch(error) {
  content.innerHTML = `<p class="sub" style="color:red">Erro: ${error.message}</p>`;
 }
}

function exitAdmin(){
 document.getElementById('mainContent').classList.remove('hidden');
 document.getElementById('adminPanel').classList.remove('active');
}

async function resetData(){
 if(confirm('ATEN√á√ÉO: Apagar TODOS os dados? Esta a√ß√£o n√£o pode ser desfeita!')){
  if(confirm('Tem ABSOLUTA certeza? Todos os presentes e mensagens ser√£o deletados!')){
    const keysObj = await storage.list('');
    if(keysObj && keysObj.keys){
     for(let key of keysObj.keys) await storage.delete(key);
    }
    items.forEach(it => it.rest = it.total);
    alert('Dados resetados!');
    exitAdmin();
    render();
  }
 }
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initApp);
} else {
  initApp();
}
</script>
</body>
</html>
